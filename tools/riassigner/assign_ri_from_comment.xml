<tool id="assign_ri_from_comment" name="Assign RI from Comment Field" version="@TOOL_VERSION@+galaxy4" profile="21.09">
    <description>Assign RI from comment field in csv, tsv, parquet, or msp files</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="creator"/>

    <xrefs>
        <xref type="bio.tools">riassigner</xref>
    </xrefs>

    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">riassigner</requirement>
    </requirements>

    <command detect_errors="exit_code"><![CDATA[
        python ${script} &&
        mv results.${input.ext} ${output}
        ]]>
    </command>

    <configfiles>
        <configfile name="script">
from RIAssigner.data import PandasData, MatchMSData
#if $input.ext in ["csv", "tsv", "parquet"]
query = PandasData('${input}', '${input.ext}', rt_unit="seconds")
#else
query = MatchMSData('${input}', '${input.ext}', rt_unit="seconds")
#end if
query.init_ri_from_comment('${format}')
query.write('results.${input.ext}')
        </configfile>
    </configfiles>

    <inputs>
        <param name="input" type="data" format="csv,tsv,parquet,msp" label="Input File">
            <help><![CDATA[
                From a file containing a comment field. The tool will read ri from the comment field and assign them
                to the RI field.
                Accepted formats: CSV, TSV, Parquet, and MSP
            ]]></help>
        </param>
        <param name="format" type="select" label="GC column type" help="Type of gas chromatographic column for which to set the retention index value">
            <option value="SemiStdNP">Semi Standard Non-Polar</option>
            <option value="StdNP">Standard Non-Polar</option>
            <option value="StdPolar">Standard Polar</option>
        </param>
    </inputs>

    <outputs>
        <data format_source="input" name="output" />
    </outputs>

    <tests>
        <test>
            <param name="input" value="nist_to_ri_2mols_input.csv" ftype="csv"/>
            <output name="output" file="nist_to_ri_2mols_output.csv" ftype="csv"/>
        </test>
        <test>
            <param name="input" value="nist_ei_ms_2mols_input.msp" ftype="msp"/>
            <output name="output" file="nist_ei_ms_2mols_output.msp" ftype="msp"/>
        </test>
    </tests>

    <help>
        <![CDATA[
        @HELP@
        ]]>
    </help>
    
    <citations>
        <citation type="doi">10.21105/joss.04337</citation>
    </citations>
</tool>

