<macros>
    <token name="@TOOL_VERSION@">1.0.0</token>
    <xml name="requirements">
        <requirements>
            <requirement type="package" version="@TOOL_VERSION@">r-scp</requirement>
        </requirements>
    </xml>

    <xml name="refs">
        <xrefs>
               <xref type="bio.tools">mfassignr</xref>
        </xrefs>
    </xml>

    <xml name="creator">
        <creator>
            <person
                givenName="Kristina"
                familyName="Gomoryova"
                url="https://github.com/KristinaGomoryova"
                identifier="0000-0003-4407-3917" />
            <person
                givenName="Helge"
                familyName="Hecht"
                url="https://github.com/hechth"
                identifier="0000-0001-6744-996X" />
            <organization
                url="https://www.recetox.muni.cz/"
                email="GalaxyToolsDevelopmentandDeployment@space.muni.cz"
                name="RECETOX MUNI" />
        </creator>
    </xml>

    <xml name="scp_param">
       <param name="input_data" type="data" format="tabular" label="Input evidence table"
              help= "Input file is the evidence.txt table from MaxQuant"/>
       <param name="input_annotations" type="data" format="tabular" label="Sample annotations table"
              help= "A data table specifying metadata; sample annotations."/>
       <param name="runcol" type="text" value="Raw.file" label="Which column specifies the run identifier and batch name?" help= "Column to specify both the run identifier and batch name, has to be present in both tables."/>
       <param name="remove_empty_columns" type="boolean" checked="true" truevalue="TRUE" falsevalue="FALSE" label="Remove empty columns?" help="Whether the empty columns should be removed."/>

       <section name="filtering_data" title="Data Filtering" expanded="true">
            <param name="filter_reverse" type="boolean" checked="true" truevalue="TRUE" falsevalue="FALSE" label="Filter reverse sequences?" help="Whether to filter the proteins labelled as 'reverse'."/>
            <param name="filter_contaminants" type="boolean" checked="true" truevalue="TRUE" falsevalue="FALSE" label="Filter potential contaminants?" help="Whether to filter the proteins labelled as 'potential contaminant'."/>
            <param name="PIF_threshold" type="float" value="0.8" label="Parental ion fraction (PIF) threshold"
               help="The threshold for parental ion fraction (PIF)"/>
            <param name="minimum_features" type="integer" value="150" label="Minimum number of PSMs per assay required" help="What is the minimum number of peptide-to-spectrum matches per assay to keep the assay?"/>   
            <param name="count_cell_carrier" type="integer" value="200" label="Number of cells in the carrier channel" help="What is the number of cells in the carrier channel?"/> 
            <param name="single_cells" type="select" label="Single-cell channels present in the experiment" multiple="true" help = "What are the single-cell channels present in the experiment?">
                    <options from_dataset="input_annotations">
                        <column name="name" index="3"/>
                        <column name="value" index="3"/>
                        <filter type="unique_value" name="unique" column="3"/>
                    </options>
            </param>
            <param name="SCR_threshold" type="float" value="0.1" label="Mean SCR threshold"
            help="Mean sample-to-carrier (SCR) threshold. 0.1 corresponds to 10%"/> 
            <param name = "qvalue_level" type="select" display="radio" label="Filter based on PSM, peptide or protein-level q-values?" help= "Whether to perform the q-value computation and filtration on the PSM, peptide or protein level.">
                    <option value="PSM">PSM</option>
                    <option value="peptide">peptide</option>
                    <option value="protein" selected="true">protein</option> 
            </param>    
            <param name="qvalue_threshold" type="float" value="0.01" label="q-value threshold"
            help="Q-value threshold."/>    
            <param name="divide_reference" type="boolean" checked="true" truevalue="TRUE" falsevalue="FALSE" label="Compute relative reporter ion intensities?" help="Whether to compute the relative reporter ion intensities by dividing the single-cell intensities by the reference channel. Specific for SCOPE2 data."/>                  
       </section>

        <section name="peptide_aggregation" title="Aggregation to peptides" expanded="true">
            <param name = "aggregation_peptides" type="select" label="Which function to use for the aggregation?" help= "How to aggregate PSMs to peptides?">
                    <option value="colMedians" selected="true">colMedians()</option> 
                    <option value="medianPolish">medianPolish()</option>
                    <option value="colMeans">colMeans()</option>
                    <option value="colSums">colSums()</option>
                    <option value="robustSummary">robustSummary()</option>
            </param>    
            <param name="column_aggregation_peptides" type="text" value="Modified.sequence" label="Which column should be used for the PSM to peptide aggregation?" help= "Which column should be used for the PSM to peptide aggregation."/>
        </section>

        <section name="peptide_filtering" title="Aggregation to peptides" expanded="true">
            <param name="samples_to_keep" type="select" label="Which samples to keep?" multiple="true" help = "Which samples to keep? We recommend filtering out Carrier and Unused channels at this step.">
                <options from_dataset="input_annotations">
                    <column name="name" index="3"/>
                    <column name="value" index="3"/>
                    <filter type="unique_value" name="unique" column="3"/>
                </options>
            </param>
            <conditional name="filter_median_intensity">
                <param type="select" label="Filter based on median relative intensity?" help= "Whether to filter based on median intensity.">
                    <option value="no" selected="true">no</option> 
                    <option value="yes">yes</option>
                </param>     
                <when value="yes">
                    <param label="Median intensity threshold" name="median_intensity_threshold" type="float" value="0.4"
                    help="Threshold for relative median intensity filtering."/>
                </when>
            </conditional>
            <conditional name="filter_median_CV">
                <param type="select" label="Filter based on median CV?" help= "Whether to filter based on median CV.">
                    <option value="yes" selected="true">yes</option> 
                    <option value="no">no</option>
                </param>     
                <when value="yes">
                    <param label="How many peptides per protein are required to compute CV?" name="minimum_peptides_CV" type="integer" value="5" help="Threshold for relative median CV filtering."/>
                    <param label="Median CV threshold" name="median_CV_threshold" type="float" value="0.65" help="Threshold for median CV filtering."/>
                </when>
            </conditional>
            <param name="remove_blank" type="boolean" checked="true" truevalue="TRUE" falsevalue="FALSE" label="Remove blank sample?" help="Whether to remove the blank sample. If it has been already removed, set to 'false'."/>    
        </section>
    </xml>

    <xml name="citations">
        <citations>
            <citation type="doi">10.1016/j.envres.2020.110114</citation>
        </citations>        
    </xml>

</macros>
